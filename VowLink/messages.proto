syntax = "proto3";
package proto;

//
// Network
//

message Hello {
  int32 version = 1;
  int32 rate_limit = 3; // maximum number of messages per hour
}

message EncryptedMessage {
  bytes channel_id = 1;
  bytes encrypted_content = 2;
}

message Link {
  message TBS {
    bytes trustee_pub_key = 1;
    double expiration = 2;
    string display_name = 3;
  }

  TBS tbs = 1;
  bytes signature = 2;
}

message EncryptedLink {
  bytes box = 1;
}

message LinkRequest {
  string peer_id = 1;
  bytes trustee_pub_key = 2;
  string desired_display_name = 3;
}

message SignedMessage {
  message TBS {
    repeated Link chain = 1;
    string content = 2; // JSON
  }

  bytes contents = 1;
}

message Subscribe {
  repeated bytes channel_id = 1;
}

message Unsubscribe {
  repeated bytes channel_id = 1;
}

message Packet {
  oneof content {
    EncryptedMessage msg = 1;
    EncryptedLink link = 2;
    Subscribe subscribe = 3;
    Unsubscribe unsubscribe = 4;
  }
}

//
// Storage
//

message Identity {
  bytes public_key = 1;
  bytes secret_key = 2;
  repeated Link links = 3;
}
